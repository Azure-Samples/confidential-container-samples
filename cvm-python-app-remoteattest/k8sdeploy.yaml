- apiVersion: v1
  kind: Namespace
  metadata:
    name: attestationpy
  spec:
    finalizers:
      - kubernetes
- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: attestationpy
    namespace: default
  spec:
    replicas: 1
    selector:
      matchLabels:
        app: attestationpy
    template:
      metadata:
        labels:
          app: attestationpy
      spec:
       nodeSelector:
        "kubernetes.azure.com/agentpool": confcompool1
        containers:
          - name: attestationpy
            image: nramar/cvmpythonattestapi:latest
            imagePullPolicy: IfNotPresent
            volumeMounts:
              - mountPath: /sys/kernel/security
                name: tcg
              - mountPath: /dev/tpmrm0
                name: tpmrm0
            securityContext:
              privileged: true
        volumes:
            - name: tcg
              hostPath:
                path: /sys/kernel/security
            - name: tpmrm0
              hostPath:
                path: /dev/tpmrm0
        restartPolicy: Always
- apiVersion: v1
  kind: Service
  metadata:
    name: cvmattestpython-service
    namespace: default
  spec:
    type: LoadBalancer
    ports:
      - port: 80
    selector:
      app:  attestationpy
